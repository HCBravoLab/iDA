---
title: "Geauvadis iDA processing"
author: "Theresa Alexander reesyxan@umd.edu"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Load iDA
```{r}
source("~/Desktop/iDA/R/iDA.R")
source("~/Desktop/iDA/R/LDA.R")
library(iDA)
```


#get Geuvadis (GVD) expression and phenotype data
```{r}
#this GVD table was made by doing varianceStabilizingTransformation(counts) of original GVD counts data
GVD <- read.table("~/Desktop/iDA_files/datasets/Geuvadis/vst_counts_462unduped.txt")

#pheno data
unduped_samples = read.csv("~/Desktop/iDA_files/datasets/Geuvadis/sampleids.csv")
coldata <- read.csv("~/Desktop/iDA_files/datasets/Geuvadis/E-GEUV-3.sdrf.csv",  header = TRUE, row.names = "AssayName")
coldata = coldata[unduped_samples$x,]
coldata_pop_lab = coldata[,c(2,6)]
```


#Run iDA on GVD data
```{r}
#run iDA
GVD_iDA <- iDA_core(data.use = as.matrix(GVD), 
                    NormCounts = as.matrix(GVD), 
                    set.seed = 11, 
                    var.Features = "disp")

#save iDA embedding and idents
GVD_iDA_ident = GVD_iDA[[1]]
GVD_iDAembedding = GVD_iDA[[2]]

rownames(GVD_iDAembedding) = colnames(GVD)
GVD_iDAembedding = cbind(GVD_iDAembedding, coldata_pop_lab[ rownames(GVD_iDAembedding),])
```


#PCA on GVD 
```{r}
#find same variable features
var.features <- GVD_iDA[[4]]

#embedding
GVD_PCAembedding = svd(GVD[var.features,])$v
```


# tSNE on iDA embedding versus PCA embedding
```{r}
library(Rtsne)
library(ggplot2)

GVD_iDA_tsne <- Rtsne(GVD_iDAembedding[,1:ncol(GVD_iDA[[2]])])
GVD_PCA_tsne <- Rtsne(GVD_PCAembedding[,1:ncol(GVD_iDA[[2]])])


ggplot(as.data.frame(GVD_iDA_tsne$Y), aes(x=GVD_iDA_tsne$Y[,1], y = GVD_iDA_tsne$Y[,2], color = coldata$Population)) + 
  geom_point() +
  ggtitle("tSNE of iDA embedding")

ggplot(as.data.frame(GVD_PCA_tsne$Y), aes(x=GVD_PCA_tsne$Y[,1], y = GVD_PCA_tsne$Y[,2], color = coldata$Population)) + 
  geom_point() +
  ggtitle("tSNE of PCA embedding")

```
